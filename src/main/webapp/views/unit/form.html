<div ng-cloak>
    <post-render entity="unit"></post-render>


    <heading label="Дом" icon="glyphicon-home" has-next="true" href="#/house/view/{{house.id}}/1"></heading>
    <heading label="Секция" icon="glyphicon-th-large" has-next="true" href="#/section/view/{{section.id}}/1"></heading>
    <heading label="Квартира" icon="glyphicon-lock" href="#/unit/view/{{model.id}}"></heading>

    <ul class="nav nav-pills nav-justified" ng-init="tabIndex = tabIndex || 0">
        <li role="presentation" ng-class="{'active':tabIndex ===0}" ng-click="tabIndex = 0"><a
                href="javascript:void(1)">Основная информация</a></li>
        <li role="presentation" ng-class="{'active':tabIndex ===1}" ng-click="tabIndex = 1"><a
                href="javascript:void(1)">Стоимость за метр</a></li>
        <li role="presentation" ng-class="{'active':tabIndex ===2}" ng-click="tabIndex = 2"><a
                href="javascript:void(1)">Платежи</a></li>
        <li role="presentation" ng-class="{'active':tabIndex ===3}" ng-click="tabIndex = 3"><a
                href="javascript:void(1)">Документы</a></li>
    </ul>
    <br/>

    <form name="form" class="form-horizontal" role="form" xt-form novalidate ng-show="tabIndex === 0">
        <fieldset>
            <div class="form-group">
                <base-input-required label="Номер" type="text" field="number" model="model" input-span="2"
                                     no-group="true"></base-input-required>
                <base-input-required label="Строительный номер" type="text" field="structuralNumber" no-group="true"
                                     input-span="2" model="model"></base-input-required>
                <base-input-required label="Почтовый номер" type="text" field="postalNumber" model="model"
                                     input-span="2"
                                     no-group="true"></base-input-required>
            </div>
            <div class="form-group">
                <base-input-required label="Этаж" type="number" field="floor" model="model" input-span="2"
                                     no-group="true"></base-input-required>
                <base-input-required label="Стояк" type="number" field="span" no-group="true" input-span="2"
                                     model="model"></base-input-required>
                <base-input-required label="Количество комнат" type="number" field="roomCount" model="model"
                                     input-span="2"
                                     no-group="true"></base-input-required>
            </div>
            <div class="form-group">
                <base-input-required label="Стоимость ( 100% )" type="number" field="startingPrice" model="model"
                                     input-span="2" no-group="true"></base-input-required>
                <label class="control-label col-sm-2">Тип</label>

                <div class="col-sm-2">
                    <select id="type" name="type" class="form-control"
                            ng-options="type as type.name for type in unitTypes track by type.id "
                            ng-model="model.type">
                    </select>
                </div>

                <checkbox label="Забронирована" field="booked" model="model" input-span="2" label-span="2" no-group="true"></checkbox>

            </div>

            <h4 class="section">Метраж</h4>

            <div class="form-group">
                <base-input-required label="Общий" type="number" field="WHOLE" model="model.areas" input-span="1"
                                     no-group="true"></base-input-required>
                <base-input-required label="Жилой" type="number" field="HABITABLE" model="model.areas"
                                     label-span="1"
                                     input-span="1" no-group="true"></base-input-required>
                <base-input-required label="По МБТИ" type="number" field="MBTI" model="model.areas" label-span="1"
                                     input-span="1" no-group="true"></base-input-required>
                <base-input-required label="Фактический" type="number" field="ACTUAL" model="model.areas"
                                     label-span="1"
                                     input-span="1" no-group="true"></base-input-required>
            </div>
            <div ng-show="clientFound && clientFound.id">
                <h4 class="section">Клиент</h4>

                <div class="form-group">
                    <view-row label="Клиент" value="clientFound.name" no-group="true" value-span="2"></view-row>
                    <div class="col-sm-1">
                        <p class="form-control-static">
                            <a class="" href="#/client/view/{{clientFound.id}}" target="_blank">Просмотр</a>
                        </p>
                    </div>
                </div>
            </div>
        </fieldset>
        <br/>
        <div class="form-group">

            <div class="col-sm-offset-2 col-sm-10">
                <button class="btn btn-primary" ng-click="save()">Сохранить</button>
                <button class="btn btn-primary" ng-click="doBooking();" ng-if="!model.booked">Бронирование</button>
                <button class="btn btn-primary" ng-click="cancelBooking()" ng-if="model.booked"
                        bs-really="Отменить бронь?">Снять бронь
                </button>
                <button class="btn btn-default" ng-click="cancel()">Отмена</button>
            </div>
        </div>
    </form>

    <div ng-include src="'views/unit/unitPriceForm.html'"></div>
    <div ng-include src="'views/unit/unitPaymentForm.html'"></div>
    <div ng-include src="'views/unit/unitReportForm.html'"></div>


    <script type="text/ng-template" id="bookingModal.html">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Бронирование квартиры</h3>
            </div>
            <div class="modal-body">
                <div>
                    <div class="form-group">
                        <label>Клиент</label>

                        <div class="input-group">
                            <input class="form-control" name="client" ng-model="clientFound" typeahead-min-length="2"
                                   typeahead="c as clientLabel(c) for c in getClients($viewValue)"
                                   typeahead-on-select="clientChange($item)"/>

                            <div class="btn input-group-addon" style="border: 1px solid #ccc;border-left: none"
                                 ng-click="clientChange()">
                                <span style="color:dimgray;" class="glyphicon glyphicon-remove"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="okModal()">Забронировать</button>
                <button class="btn btn-default" ng-click="cancelModal()">Отмена</button>
            </div>
        </div>
    </script>

</div>